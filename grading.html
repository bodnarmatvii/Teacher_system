<div x-data="gradingModule()" x-init="init()" style="padding: 20px; display: flex; flex-direction: column; align-items: center;">
  
  <div style="width: 100%; max-width: 500px; margin-bottom: 20px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
    
    <select x-model="selectedClass" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px;">
      <option value="">üìÇ –û–±–µ—Ä—ñ—Ç—å –∫–ª–∞—Å...</option>
      <option value="9-A">9-–ê –∫–ª–∞—Å</option>
      <option value="10-B">10-–ë –∫–ª–∞—Å</option>
    </select>

    <div x-show="selectedClass">
      <select x-model="selectedStudent" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px; font-weight:bold;">
        <option value="">üë§ –û–±–µ—Ä—ñ—Ç—å —É—á–Ω—è...</option>
        <option value="–ü–µ—Ç—Ä–µ–Ω–∫–æ –Ü.">–ü–µ—Ç—Ä–µ–Ω–∫–æ –Ü.</option>
        <option value="–°–∏–¥–æ—Ä–æ–≤ –ü.">–°–∏–¥–æ—Ä–æ–≤ –ü.</option>
      </select>
    </div>

    <input type="text" x-model="topic" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px;" placeholder="‚úèÔ∏è –¢–µ–º–∞ —É—Ä–æ–∫—É...">
  </div>

  <div x-show="selectedStudent" x-transition.opacity style="width: 100%; max-width: 500px;">
    <div style="text-align:center; color:#888; font-size:13px; margin-bottom:10px;">
      –û—Ü—ñ–Ω–∫–∞ –¥–ª—è: <b x-text="selectedStudent"></b>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
      <button class="module-card high" style="height:auto; padding:15px;" @click="send(12)">12</button>
      <button class="module-card high" style="height:auto; padding:15px;" @click="send(11)">11</button>
      <button class="module-card high" style="height:auto; padding:15px;" @click="send(10)">10</button>
      <button class="module-card mid"  style="height:auto; padding:15px;" @click="send(9)">9</button>
      <button class="module-card mid"  style="height:auto; padding:15px;" @click="send(8)">8</button>
      <button class="module-card mid"  style="height:auto; padding:15px;" @click="send(7)">7</button>
      <button class="module-card low"  style="height:auto; padding:15px;" @click="send(6)">6</button>
      <button class="module-card low"  style="height:auto; padding:15px;" @click="send(5)">5</button>
      <button class="module-card absent" style="height:auto; padding:15px; grid-column: span 4;" @click="send('–ù')">–ù</button>
    </div>
  </div>

  <script>
    function gradingModule() {
      return {
        selectedClass: '', selectedStudent: '', topic: '',
        init() {},
        send(mark) {
          if(!this.topic) { app().showToast("‚ö†Ô∏è –í–∫–∞–∂—ñ—Ç—å —Ç–µ–º—É!"); return; }
          app().showToast("‚è≥ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...");
          const token = localStorage.getItem('auth_token');
          // –ü–µ—Ä–µ–¥–∞—î–º–æ —ñ–º'—è —É—á–Ω—è —Ä–∞–∑–æ–º –∑ –æ—Ü—ñ–Ω–∫–æ—é
          const fullInfo = this.selectedStudent + " (" + this.selectedClass + ")"; 
          google.script.run.withSuccessHandler(res => app().showToast(res))
            .apiSaveLog(token, mark, this.topic + " | " + fullInfo);
        }
      }
    }
  </script>
</div>